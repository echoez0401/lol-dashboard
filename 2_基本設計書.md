
---

# LoL戦績ダッシュボード 基本設計書

**バージョン**: 1.0  
**作成日**: 2026年2月2日  
**対象読者**: 実装担当者（Cursor AI）、レビュアー

---

## 1. システム概要

### 1.1 目的

League of Legendsの個人試合履歴を自動取得し、統計情報を可視化した静的HTMLダッシュボードを生成してWeb公開する。

### 1.2 システム特性

- **運用コスト**: $0（完全無料）
- **更新頻度**: 手動トリガー（試合後に任意実行）
- **公開範囲**: 個人利用、友人への配布可能
- **技術制約**: サーバーレス、データベースなし

### 1.3 ユーザーストーリー

```
As a LoLプレイヤー
I want 自分の試合統計を見やすいダッシュボードで確認したい
So that チャンピオン別の勝率や傾向を把握して上達につなげられる
```

---

## 2. システムアーキテクチャ

### 2.1 全体構成図

```
┌─────────────────────────────────────────────────────────┐
│                     ユーザー                              │
└────────────────────┬────────────────────────────────────┘
                     │ ① 手動トリガー
                     ↓
┌─────────────────────────────────────────────────────────┐
│                  GitHub Actions                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  Job: update-dashboard                            │  │
│  │  ┌────────────────────────────────────────────┐  │  │
│  │  │ Step 1: データ取得 (fetch_matches.py)      │  │  │
│  │  │   ↓                                        │  │  │
│  │  │ Step 2: 統計計算 (calculate_stats.py)     │  │  │
│  │  │   ↓                                        │  │  │
│  │  │ Step 3: HTML生成 (generate_html.py)       │  │  │
│  │  │   ↓                                        │  │  │
│  │  │ Step 4: Git Commit & Push                  │  │  │
│  │  └────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────┬────────────────────────────────────┘
                     │ ② デプロイ
                     ↓
┌─────────────────────────────────────────────────────────┐
│                  GitHub Pages                            │
│  ┌──────────────────────────────────────────────────┐  │
│  │  静的ファイル                                     │  │
│  │  - index.html (ダッシュボード)                   │  │
│  │  - css/style.css                                 │  │
│  │  - js/dashboard.js                               │  │
│  └──────────────────────────────────────────────────┘  │
└────────────────────┬────────────────────────────────────┘
                     │ ③ アクセス
                     ↓
┌─────────────────────────────────────────────────────────┐
│              ユーザーのブラウザ                           │
│  - フィルター操作（クライアント側JS）                    │
│  - 試合詳細モーダル表示                                  │
└─────────────────────────────────────────────────────────┘

外部API:
┌─────────────────────────────────────────────────────────┐
│                   Riot Games API                         │
│  - Summoner API: プレイヤー情報取得                      │
│  - Match API: 試合履歴・詳細取得                         │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                  Data Dragon CDN                         │
│  - チャンピオン画像                                      │
│  - アイテム画像                                          │
│  - ルーン画像                                            │
└─────────────────────────────────────────────────────────┘
```

### 2.2 データフロー

```
[初回実行]
Riot API → 全試合履歴取得 → data/matches.json (Git保存)
                                    ↓
                            統計計算エンジン
                                    ↓
                            Jinja2テンプレート
                                    ↓
                            docs/index.html (静的HTML)
                                    ↓
                            GitHub Pages公開

[2回目以降]
Riot API → 差分データ取得 → 既存JSONに追記 → (以下同じ)

[HTMLアクセス時]
ブラウザ → GitHub Pages → HTML読み込み → JS実行（フィルター処理）
```

---

## 3. モジュール設計

### 3.1 モジュール一覧

|モジュール名|責務|入力|出力|依存|
|---|---|---|---|---|
|**fetch_matches**|Riot APIからデータ取得|API Key, Summoner Name|matches.json|Riot API|
|**calculate_stats**|統計計算・フィルタリング|matches.json, フィルター条件|統計データ|-|
|**generate_html**|静的HTML生成|matches.json, 統計データ|index.html|Jinja2|
|**dashboard.js**|フロントエンド処理|matches.json (埋め込み)|DOM操作|-|
|**utils**|共通処理|-|ユーティリティ関数|-|

### 3.2 モジュール依存関係

```
┌──────────────────┐
│  GitHub Actions  │
└────────┬─────────┘
         │
    ┌────▼─────┐
    │  utils   │
    └────┬─────┘
         │
    ┌────▼──────────┐
    │fetch_matches  │ ──→ data/matches.json
    └───────────────┘
         │
    ┌────▼──────────────┐
    │calculate_stats    │
    └───────────────────┘
         │
    ┌────▼──────────┐
    │generate_html  │ ──→ docs/index.html
    └───────────────┘
                           ↓
                    ┌──────────────┐
                    │dashboard.js  │
                    └──────────────┘
```

### 3.3 ファイル構成

```
lol-dashboard/
├── .github/
│   └── workflows/
│       └── update.yml              # GitHub Actions定義
│
├── data/
│   └── matches.json                # 試合データ（Git管理）
│
├── docs/                           # GitHub Pages公開ディレクトリ
│   ├── index.html                  # 生成されたダッシュボード
│   ├── css/
│   │   └── style.css               # スタイルシート
│   ├── js/
│   │   └── dashboard.js            # クライアントサイド処理
│   └── assets/
│       └── placeholder.png         # 画像読み込み失敗時の代替
│
├── src/                            # Pythonソース
│   ├── __init__.py
│   ├── fetch_matches.py            # データ取得モジュール
│   ├── calculate_stats.py          # 統計計算モジュール
│   ├── generate_html.py            # HTML生成モジュール
│   └── utils.py                    # 共通ユーティリティ
│
├── templates/                      # Jinja2テンプレート
│   ├── base.html                   # ベーステンプレート
│   ├── index.html                  # メインダッシュボード
│   └── components/
│       ├── champion_table.html     # チャンピオン統計テーブル
│       ├── match_history.html      # 試合履歴リスト
│       └── match_detail_modal.html # 試合詳細モーダル
│
├── config.json                     # 設定ファイル
├── requirements.txt                # Python依存パッケージ
├── .gitignore
└── README.md                       # セットアップ手順（簡易版）
```

---

## 4. データ設計

### 4.1 データ保存方式

**選定**: JSON形式 + Gitリポジトリ

**理由**:

- 追加コストなし（データベース不要）
- バージョン管理可能
- 差分更新が容易
- テキストデータなので容量小（5000試合で約20MB）

### 4.2 データライフサイクル

```
[初回実行]
1. Riot APIから全試合ID取得（ページネーション）
2. 各試合の詳細を取得
3. 内部形式に変換
4. data/matches.json に保存
5. Git commit & push

[2回目以降]
1. 既存JSONから最終更新日時を取得
2. それ以降の新規試合のみAPIから取得
3. 既存データとマージ（重複排除）
4. 日時順ソート
5. 上書き保存 & commit

[データ参照]
- Python: json.load() で読み込み
- JavaScript: HTML内に埋め込んで参照
```

### 4.3 データスキーマ概要

```json
{
  "last_update": "ISO 8601形式の日時",
  "summoner": {
    "name": "サマナー名",
    "puuid": "プレイヤー固有ID",
    "region": "地域コード"
  },
  "matches": [
    {
      "matchId": "試合ID",
      "gameCreation": "Unix timestamp (ms)",
      "queueId": "ゲームモードID",
      "gameDuration": "試合時間（秒）",
      "gameVersion": "パッチバージョン",
      "myData": { /* 自分のデータ */ },
      "allPlayers": [ /* 10人分のデータ */ ]
    }
  ]
}
```

詳細スキーマは詳細設計書に記載。

---

## 5. UI/UX設計仕様

### 5.1 デザインコンセプト

**参考サイト**: DeepLoL.gg

**コンセプト**:

- **ミニマリズム**: 装飾を排し、情報に集中
- **ダークテーマ**: 長時間閲覧でも目に優しい
- **情報密度**: 統計数値を効率的に配置
- **視認性**: 勝敗・重要数値が一目でわかる

**デザイン禁止事項**:

- ❌ グラデーション（単色のみ使用）
- ❌ 過度なシャドウ・ブラー
- ❌ 不要なアニメーション（ホバー時の軽微な変化のみOK）
- ❌ 派手なボーダー・装飾
- ❌ 「おしゃれ」を意識した過剰装飾

### 5.2 カラーパレット

```css
/* ベースカラー */
--bg-primary: #0a0e27;      /* 背景（濃紺） */
--bg-secondary: #151932;    /* カード背景 */
--bg-tertiary: #1a1f3a;     /* ホバー時背景 */

/* テキストカラー */
--text-primary: #e8e9ed;    /* メインテキスト */
--text-secondary: #7c8698;  /* 補助テキスト */
--text-dim: #4a5568;        /* さらに薄い */

/* アクセントカラー */
--accent-blue: #5383e8;     /* 勝利 */
--accent-red: #e84057;      /* 敗北 */
--accent-gold: #f0b232;     /* 強調 */
--accent-green: #31c48d;    /* ポジティブ */

/* ボーダー */
--border-dark: #2d3748;     /* 区切り線 */
--border-light: #4a5568;    /* 軽い区切り */
```

**使用ルール**:

- 勝率50%以上: `--accent-blue`
- 勝率50%未満: `--accent-red`
- ランクエンブレムなど特別な要素: `--accent-gold`

### 5.3 タイポグラフィ

```css
/* フォントファミリー */
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 
             'Noto Sans JP', sans-serif;

/* フォントサイズスケール */
--text-xs: 0.75rem;    /* 12px - メタ情報 */
--text-sm: 0.875rem;   /* 14px - 補助テキスト */
--text-base: 1rem;     /* 16px - 本文 */
--text-lg: 1.125rem;   /* 18px - 小見出し */
--text-xl: 1.5rem;     /* 24px - セクション見出し */
--text-2xl: 2rem;      /* 32px - ページタイトル */

/* 行間 */
line-height: 1.6;      /* 通常テキスト */
line-height: 1.2;      /* 見出し */

/* フォントウェイト */
--weight-normal: 400;
--weight-medium: 500;
--weight-bold: 700;
```

### 5.4 レイアウトグリッド

```
全体レイアウト:
┌─────────────────────────────────────────┐
│           ヘッダー (padding: 24px)      │
├─────────────────────────────────────────┤
│       フィルターバー (padding: 20px)    │
├─────────────────────────────────────────┤
│                                         │
│   チャンピオン統計セクション            │
│   (max-width: 1400px, margin: auto)    │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│   試合履歴セクション                    │
│   (max-width: 1400px, margin: auto)    │
│                                         │
└─────────────────────────────────────────┘

余白ルール:
- セクション間: 40px
- カード間: 12px
- 要素内余白: 16px (標準), 20px (カード), 24px (ヘッダー)
```

### 5.5 コンポーネント仕様

#### 5.5.1 ヘッダー

```
┌───────────────────────────────────────────┐
│  サマナー名 (text-2xl, bold)              │
│  最終更新: 2026-02-02 10:30 (text-sm, dim)│
└───────────────────────────────────────────┘

背景: --bg-secondary
パディング: 24px
テキスト中央揃え
ボーダー: なし
```

#### 5.5.2 フィルターバー

```
┌───────────────────────────────────────────┐
│  期間: [▼全期間    ]  モード: [▼全モード  ]│
└───────────────────────────────────────────┘

背景: --bg-secondary
レイアウト: flexbox, gap: 20px
セレクトボックス:
  - 背景: --bg-primary
  - ボーダー: 1px solid --border-dark
  - パディング: 8px 12px
  - border-radius: 4px
  - ホバー時: border-color → --border-light
```

#### 5.5.3 チャンピオン統計テーブル

```
┌──────────────────────────────────────────────────────────┐
│ チャンピオン │ 試合数 │ 勝率    │ KDA  │ 平均与ダメ │  ← thead
├──────────────────────────────────────────────────────────┤
│ [画像] Ahri  │   25   │ 60% ✓   │ 5.2  │  24,500    │  ← tbody
│ [画像] Jinx  │   18   │ 45% ✗   │ 4.1  │  28,300    │
│      ...                                                 │
└──────────────────────────────────────────────────────────┘

テーブルスタイル:
  - 背景: --bg-secondary
  - ヘッダー背景: --bg-tertiary
  - 行ボーダー: 1px solid --border-dark
  - ホバー時: 背景 → --bg-tertiary
  - パディング: 12px 16px

チャンピオン画像:
  - サイズ: 40x40px
  - border-radius: 50%
  - margin-right: 8px

勝率表示:
  - 50%以上: --accent-blue
  - 50%未満: --accent-red
  - 勝敗数は (15W-10L) 形式、--text-secondary
```

#### 5.5.4 試合履歴カード

```
┌──────────────────────────────────────────────────┐
│ [勝利] [Ahri画像]  5/3/10 (5.0 KDA)  ランクソロ  │
│                                       18分30秒   │
└──────────────────────────────────────────────────┘

レイアウト: Grid (80px | 80px | 1fr | 150px)
背景: --bg-secondary
左ボーダー: 4px solid (勝利=blue, 敗北=red)
パディング: 16px
border-radius: 6px
ホバー時: transform: translateX(5px), transition: 0.2s

勝敗バッジ:
  - パディング: 6px 12px
  - border-radius: 4px
  - 勝利: 背景 --accent-blue
  - 敗北: 背景 --accent-red
  - テキスト: bold, --text-primary

KDA表示:
  - メイン数値: text-lg, bold
  - 比率: text-sm, --text-secondary
```

#### 5.5.5 試合詳細モーダル

```
┌────────────────────────────────────────────┐
│  ✕                                         │ ← 閉じるボタン
│  試合詳細                                  │
│  ─────────────────────────────────────     │
│  試合ID: JP1_123456789                     │
│  日時: 2026-02-02 14:30                    │
│                                            │
│  【味方チーム - 勝利】                     │
│  ┌───────────────────────────────────┐    │
│  │ チャンピオン │ プレイヤー │ KDA │...│    │
│  └───────────────────────────────────┘    │
│                                            │
│  【敵チーム - 敗北】                       │
│  ┌───────────────────────────────────┐    │
│  │         ...                      │    │
│  └───────────────────────────────────┘    │
└────────────────────────────────────────────┘

モーダル背景: rgba(0, 0, 0, 0.85)
コンテンツ背景: --bg-secondary
最大幅: 1200px
最大高さ: 80vh
overflow-y: auto
border-radius: 8px
パディング: 32px

チームヘッダー:
  - 青チーム: 背景 rgba(83, 131, 232, 0.1)
  - 赤チーム: 背景 rgba(232, 64, 87, 0.1)
  - パディング: 12px
  - margin-bottom: 8px
```

### 5.6 インタラクション仕様

**ホバー効果**:

```css
/* テーブル行 */
tr:hover {
    background: var(--bg-tertiary);
    transition: background 0.15s ease;
}

/* 試合カード */
.match-card:hover {
    transform: translateX(5px);
    transition: transform 0.2s ease;
}

/* セレクトボックス */
select:hover {
    border-color: var(--border-light);
}
```

**クリック操作**:

- テーブルヘッダー: ソート切り替え（昇順↔降順）
- 試合カード: モーダル表示
- モーダル背景/✕ボタン: モーダル閉じる

**レスポンシブ**:

- 最小幅: 1024px
- 1024px未満: 非対応（デスクトップ専用）
- ウィンドウリサイズ時: レイアウト調整（崩れない程度）

### 5.7 アクセシビリティ

**最低限の対応**:

- キーボード操作: Tabキーでフォーカス移動可能
- モーダル: Escキーで閉じる
- カラーコントラスト: WCAG AA準拠（背景と文字の明度差4.5:1以上）
- 画像alt属性: チャンピオン名を指定

**非対応**:

- スクリーンリーダー最適化
- ARIA属性（最小限のみ）
- 高コントラストモード

---

## 6. 外部API設計

### 6.1 Riot Games API

**使用エンドポイント**:

|API|エンドポイント|用途|レート制限|
|---|---|---|---|
|Summoner-v4|`/lol/summoner/v4/summoners/by-name/{name}`|サマナー情報取得|20/s, 100/2m|
|Match-v5|`/lol/match/v5/matches/by-puuid/{puuid}/ids`|試合IDリスト取得|20/s, 100/2m|
|Match-v5|`/lol/match/v5/matches/{matchId}`|試合詳細取得|20/s, 100/2m|

**リージョン構成**:

- プラットフォームAPI（jp1）: Summoner-v4
- リージョナルAPI（asia）: Match-v5

**認証方式**:

- ヘッダー: `X-Riot-Token: {API_KEY}`
- API KeyはGitHub Secretsで管理

**エラーハンドリング**:

- 429（Rate Limit）: `Retry-After`ヘッダーを参照して待機
- 404（Not Found）: ログ出力して次へ
- 5xx（Server Error）: 3回リトライ、失敗時は例外スロー

### 6.2 Data Dragon CDN

**ベースURL**: `https://ddragon.leagueoflegends.com/`

**使用リソース**:

```
バージョン情報:
/api/versions.json → 最新パッチ番号取得

チャンピオン画像:
/cdn/{version}/img/champion/{championName}.png

アイテム画像:
/cdn/{version}/img/item/{itemId}.png

ルーン画像:
/cdn/img/perk-images/Styles/{runeId}.png
```

**キャッシュ戦略**:

- ブラウザキャッシュに依存
- 画像読み込み失敗時: placeholder.png表示

---

## 7. 非機能設計

### 7.1 パフォーマンス要件

|項目|目標値|測定方法|
|---|---|---|
|初回データ取得|90分以内（5000試合想定）|GitHub Actionsログ|
|差分更新|2分以内（週50試合想定）|GitHub Actionsログ|
|HTML表示速度|2秒以内（First Contentful Paint）|Lighthouse|
|フィルター切り替え|0.5秒以内|Performance API|

**パフォーマンス最適化**:

- データ取得: レート制限内で最大限並列化しない（シンプル優先）
- HTML生成: テンプレートキャッシュ（Jinja2デフォルト）
- フロントエンド: 仮想DOM不使用、直接DOM操作

### 7.2 セキュリティ要件

|項目|対策|
|---|---|
|API Key管理|GitHub Secretsに保存、コードに埋め込まない|
|個人情報|Summoner Nameと試合履歴のみ（公開情報）|
|XSS対策|Jinja2のautoescapeデフォルト有効|
|CORS|不要（静的HTML）|

**機密情報**:

- API Key: 24時間で失効するPersonal Key使用
- PUUID: 内部使用のみ、HTML出力しない

### 7.3 可用性要件

**稼働率**: 99%（GitHub Pagesに依存）

**障害時対応**:

- Riot API障害: エラーログ出力、次回実行時にリトライ
- GitHub Pages障害: 復旧待ち（代替手段なし）
- Data Dragon障害: placeholder画像表示

**バックアップ**:

- データ: Git履歴がバックアップ
- 復旧方法: 過去コミットからリストア

### 7.4 保守性要件

**コード規約**:

- Python: PEP 8準拠
- JavaScript: ESLint推奨設定
- CSS: BEM命名規則（緩く適用）

**ドキュメント**:

- 各関数: docstring必須
- 複雑な処理: インラインコメント
- README: セットアップ手順

**テスト**:

- 単体テスト: 任意（時間あれば実装）
- 結合テスト: 実環境での手動テスト

### 7.5 拡張性要件

**将来の拡張候補**:

- グラフ表示（Chart.js導入）
- 自動更新（cronトリガー）
- 他プレイヤー検索
- チーム統計

**拡張を考慮した設計**:

- モジュール分割: 疎結合
- 設定外部化: config.json
- ゲームモード: 動的対応（queueId自動判定）

---

## 8. 制約事項

### 8.1 技術的制約

- サーバーサイド処理不可（静的ホスティングのみ）
- データベース不可（JSONファイルのみ）
- リアルタイム更新不可（手動トリガー）
- Riot API Personal Keyの制限（20req/s, 100req/2m）

### 8.2 運用制約

- GitHub Actions: 月2000分無料枠
- GitHub Pages: 100GBストレージ、月100GB転送
- Riot API: Personal Keyは24時間で失効可能性

### 8.3 仕様制約

- 試合履歴: Riot側で約2年分保持
- Data Dragon: 新パッチ公開後、旧パッチ画像も継続提供
- ゲームモード: 期間限定モードは事前定義不可

---

## 9. 移行・展開計画

### 9.1 開発環境

```
ローカル開発:
- Python 3.11以上
- Cursor (VS Code拡張)
- Git

テスト環境:
- ローカルでHTMLプレビュー
- python -m http.server で簡易サーバー起動

本番環境:
- GitHub Pages
```

### 9.2 デプロイフロー

```
1. ローカルで実装
2. Git commit
3. GitHub push
4. GitHub Actions手動実行
5. 初回データ取得（30-90分）
6. GitHub Pages公開確認
```

### 9.3 友人への配布

```
1. リポジトリをPublicで公開
2. 友人がFork
3. config.json書き換え
4. GitHub Secrets設定
5. Actions実行
```

---

## 10. 成功基準

### 10.1 機能的成功基準

- [ ] 全試合履歴が取得できる
- [ ] チャンピオン別統計が正しく表示される
- [ ] 期間・モードフィルターが動作する
- [ ] 試合詳細モーダルが表示できる
- [ ] GitHub Pagesで公開できる

### 10.2 非機能的成功基準

- [ ] 運用コスト$0を維持
- [ ] HTML表示2秒以内
- [ ] 差分更新2分以内
- [ ] API Key漏洩ゼロ

### 10.3 LT発表基準

- [ ] デモ画面を見せられる
- [ ] ワークフロー（Claude→Cursor）を説明できる
- [ ] 質疑応答に耐えうる完成度

---
