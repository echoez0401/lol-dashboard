

---

# LoL戦績ダッシュボード 要件定義書

**プロジェクト名**: LoL Match History Dashboard  
**作成日**: 2026年2月2日  
**対象**: 個人利用（将来的に友人への配布可能性あり）  
**開発期間**: 1週間  
**コスト制約**: 完全無料（$0）

---

## 1. プロジェクト概要

### 1.1 目的

League of Legends（LoL）の自分の試合履歴を自動取得し、統計情報を可視化した静的HTMLダッシュボードを生成してWeb公開する。

### 1.2 背景

- 既存の統計サイト（DeepLoL、OP.GG）とは異なる形式で自分のデータを分析したい
- 完全無料で運用可能なパーソナルダッシュボードが欲しい
- 部内LTで「Claude（要件定義・設計）→ Cursor（実装）」のワークフロー実演

### 1.3 スコープ

- **対象範囲**: 自分のアカウントの全試合履歴の取得・統計化・可視化
- **対象外**:
    - AIによる分析・スコアリング
    - リアルタイム更新
    - 他プレイヤーの検索機能
    - ソーシャル機能（コメント、共有など）

---

## 2. システムアーキテクチャ

### 2.1 全体フロー

```
[手動トリガー] 
    ↓
[GitHub Actions]
    ↓
[Riot Games API] ← API Key取得
    ↓
[試合データ取得（Python）]
    ↓
[data/matches.json に保存] → Git commit
    ↓
[統計計算（Python）]
    ↓
[静的HTML生成（Python）]
    ↓
[GitHub Pages デプロイ]
    ↓
[ユーザーがブラウザでアクセス] → 1-2秒で表示
```

### 2.2 データフロー詳細

#### 初回実行（30-90分想定）

1. Riot API から全試合履歴を取得（推定2000-5000試合）
2. `data/matches.json` に保存
3. 統計HTML生成 → GitHub Pages公開

#### 2回目以降の実行（1-2分想定）

1. 前回実行時刻以降の新規試合のみ取得
2. 既存JSONに追記
3. 統計HTML再生成 → 更新

#### HTMLアクセス時（1-2秒）

- 既に生成済みの静的HTMLを表示
- フィルター操作はクライアントサイドJavaScriptで処理

### 2.3 技術スタック

|レイヤー|技術|理由|
|---|---|---|
|データ取得|Riot Games API (Personal Key)|無料、公式、個人利用十分|
|実行環境|GitHub Actions (手動トリガー)|無料、API Key安全管理、スケジュール不要|
|データ保存|Git リポジトリ（JSON）|履歴管理、差分更新可能、無料|
|処理言語|Python 3.11+|Riot API SDK、データ処理ライブラリ豊富|
|HTML生成|Jinja2 テンプレート|Pythonと相性良い、保守性高い|
|公開|GitHub Pages|無料、独自ドメイン不要、CDN|
|フロントエンド|HTML + CSS + Vanilla JS|軽量、依存なし、高速表示|

---

## 3. 機能要件

### 3.1 データ取得機能

#### 3.1.1 取得対象

- **対象アカウント**: 設定ファイルで指定したSummoner Name
- **対象地域**: デフォルトJP1（設定変更可能）
- **取得範囲**: 全試合履歴（初回）／前回以降の新規試合（2回目以降）

#### 3.1.2 取得データ項目

各試合について以下を取得：

**試合基本情報**

- 試合ID（matchId）
- 試合日時（gameCreation）
- ゲームモード（queueId）: ランク戦、ノーマル、ARAM、期間限定モード等すべて
- 試合時間（gameDuration）
- ゲームバージョン（gameVersion）
- 勝敗（win）

**自分のデータ**

- チャンピオン（championName）
- KDA（kills / deaths / assists）
- 与ダメージ（totalDamageDealtToChampions）
- 被ダメージ（totalDamageTaken）
- アイテムビルド（item0-6 の購入履歴タイムスタンプ付き）
- ルーン（perks: メイン5個 + サブ2個 + ステータス3個）

**全プレイヤー情報（10人分）**

- Summoner Name
- チャンピオン
- KDA
- 与ダメージ / 被ダメージ
- ランク（現在のティア情報）
- アイテムビルド（最終6アイテム）
- ルーン

#### 3.1.3 API呼び出し設計

```python
# 初回実行
1. GET /lol/summoner/v4/summoners/by-name/{summonerName}
   → puuid取得
   
2. GET /lol/match/v5/matches/by-puuid/{puuid}/ids?start={offset}&count=100
   → 試合IDリスト取得（全件取得まで繰り返し）
   
3. 各試合IDについて:
   GET /lol/match/v5/matches/{matchId}
   → 試合詳細取得
   
   レート制限対策:
   - 100リクエスト/2分 を遵守
   - リトライロジック実装（429エラー時）
   - sleep(1.2) で約50リクエスト/分に制限

# 2回目以降
前回取得の最新試合日時以降のみ取得
```

#### 3.1.4 データ保存形式

```json
// data/matches.json
{
  "last_update": "2026-02-02T10:30:00Z",
  "summoner": {
    "name": "SummonerName",
    "puuid": "xxx",
    "region": "jp1"
  },
  "matches": [
    {
      "matchId": "JP1_123456789",
      "gameCreation": 1706870400000,
      "queueId": 420,
      "gameDuration": 1800,
      "gameVersion": "14.3.123.4567",
      "myData": {
        "championName": "Ahri",
        "kills": 5,
        "deaths": 3,
        "assists": 10,
        "totalDamageDealtToChampions": 25000,
        "totalDamageTaken": 15000,
        "win": true,
        "items": [
          {"itemId": 3089, "timestamp": 600},
          {"itemId": 3020, "timestamp": 900},
          ...
        ],
        "runes": {
          "primary": [3005, 3008, 3009, 3041, 3042],
          "secondary": [8009, 8014],
          "stats": [5008, 5008, 5001]
        }
      },
      "allPlayers": [
        {
          "summonerName": "Player1",
          "teamId": 100,
          "championName": "Jinx",
          "kills": 8,
          "deaths": 2,
          "assists": 7,
          "totalDamageDealtToChampions": 30000,
          "totalDamageTaken": 12000,
          "tier": "DIAMOND",
          "rank": "II",
          "items": [3031, 3094, 3087, ...],
          "runes": {...}
        },
        ...（10人分）
      ]
    },
    ...
  ]
}
```

### 3.2 統計計算機能

#### 3.2.1 全体統計

以下を計算してHTMLに埋め込む：

**チャンピオン別統計**

- 使用回数（games）
- 勝利数（wins）
- 敗北数（losses）
- 勝率（winRate = wins / games * 100）
- 合計キル / デス / アシスト
- 平均KDA（(kills + assists) / deaths）
- 平均与ダメージ
- 平均被ダメージ

**期間別集計**

- 全期間
- パッチごと（gameVersionから抽出）
- 週ごと（試合日時から月曜日起算で集計）

**モード別集計**

- queueId でゲームモード判定
    - 420: ランクソロ/デュオ
    - 440: ランクフレックス
    - 400/430: ノーマル
    - 450: ARAM
    - その他: 期間限定モード（動的に対応）

#### 3.2.2 試合履歴

- 直近20試合をデフォルト表示
- 設定で10-50試合に変更可能

### 3.3 UI/表示機能

#### 3.3.1 ページ構成

```
index.html（メインダッシュボード）
├─ ヘッダー
│  ├─ サマナー名表示
│  ├─ 最終更新日時
│  └─ フィルター操作エリア
│
├─ 全体統計セクション
│  ├─ 期間フィルター [全期間 | パッチ14.3 | パッチ14.2 | 今週 | 先週 ...]
│  ├─ モードフィルター [全モード | ランク | ノーマル | ARAM | その他]
│  └─ チャンピオン統計テーブル
│     ├─ ソート機能（勝率順、使用回数順、KDA順）
│     └─ 各行にチャンピオン画像 + 統計数値
│
└─ 試合履歴セクション
   ├─ 直近N試合リスト（デフォルト20）
   └─ 各試合カード
      ├─ 勝敗アイコン（青/赤背景）
      ├─ チャンピオン画像
      ├─ KDA表示
      ├─ 試合時間
      └─ クリックで詳細モーダル表示

match_detail.html（試合詳細モーダル）
├─ 試合基本情報
│  ├─ 試合日時
│  ├─ ゲームモード
│  ├─ 試合時間
│  └─ パッチバージョン
│
├─ 味方チーム（青）
│  └─ プレイヤーテーブル（5行）
│
└─ 敵チーム（赤）
   └─ プレイヤーテーブル（5行）
```

#### 3.3.2 チャンピオン統計テーブル

```
| チャンピオン | 試合数 | 勝率 | KDA | 平均与ダメ | 平均被ダメ |
|------------|-------|------|-----|----------|----------|
| [Ahri画像] Ahri | 25 | 60% (15W-10L) | 5.2 | 24,500 | 16,200 |
| [Jinx画像] Jinx | 18 | 55.6% (10W-8L) | 4.8 | 28,300 | 14,800 |
...
```

- デフォルトソート：使用回数降順
- ヘッダークリックでソート切り替え
- 各数値は小数点1桁まで表示

#### 3.3.3 試合詳細テーブル（モーダル）

```
【味方チーム - 勝利】

| チャンピオン | プレイヤー名 | KDA | 与ダメ | 被ダメ | ランク | アイテム | ルーン |
|------------|------------|-----|-------|-------|--------|---------|-------|
| [Ahri画像] | Player1 | 5/3/10 (5.0) | 25,000 | 15,000 | [D2アイコン] | [アイテム画像×6] | [ルーン画像×2] |
| [Jinx画像] | Player2 | 8/2/7 (7.5) | 30,000 | 12,000 | [P1アイコン] | [アイテム画像×6] | [ルーン画像×2] |
...

【敵チーム - 敗北】
同様のテーブル
```

**アイテムビルド詳細表示**

- アイテム画像にホバーで購入時刻表示
- 例："3:45" "7:20" "12:30" ...
- 購入順に左から並べる

**ルーン表示**

- メインキーストーンの画像（大）
- サブパスの画像（小）
- ホバーでルーン名表示

#### 3.3.4 フィルター機能

**期間フィルター**

- プルダウンメニュー
- 選択肢：
    - 全期間
    - パッチ 14.3（直近から3パッチ分自動生成）
    - 今週（月曜起算）
    - 先週
    - 過去30日

**モードフィルター**

- チェックボックス
- 選択肢：
    - 全モード（デフォルト）
    - ランクソロ/デュオ
    - ランクフレックス
    - ノーマル
    - ARAM
    - その他（期間限定モード。試合データに存在するqueueIdを動的に表示）

**複数フィルター組み合わせ**

- 期間 × モード の AND条件
- 例：「パッチ14.3」×「ランク」→ パッチ14.3のランク戦のみ表示
- フィルター変更時にJavaScriptで即座に再計算・再描画

#### 3.3.5 画像リソース

**Data Dragon CDN 使用**

```
チャンピオン画像:
https://ddragon.leagueoflegends.com/cdn/{version}/img/champion/{championName}.png

アイテム画像:
https://ddragon.leagueoflegends.com/cdn/{version}/img/item/{itemId}.png

ルーン画像:
https://ddragon.leagueoflegends.com/cdn/img/{runeIconPath}

ランクエンブレム:
https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-shared-components/global/default/ranked-emblem-{tier}.png
```

- `{version}` は最新パッチ番号（起動時に https://ddragon.leagueoflegends.com/api/versions.json から取得）
- 画像読み込み失敗時はプレースホルダー表示

#### 3.3.6 レスポンシブ対応

- **対象**: デスクトップのみ（スマホ対応不要）
- ウィンドウ幅 1200px 以上を想定
- 最小幅 1024px でも崩れない程度のレスポンシブ
- ブラウザ: Chrome / Edge / Firefox 最新版

#### 3.3.7 デザイン方針

- シンプル・ミニマル（DeepLoL.gg風）
- グラフ不要（テーブルと数値のみ）
- カラースキーム:
    - 背景: ダークグレー (#1a1a1a)
    - テキスト: ホワイト (#ffffff)
    - 勝利: 青 (#4a90e2)
    - 敗北: 赤 (#e74c3c)
    - アクセント: ゴールド (#f39c12)

### 3.4 デプロイ機能

#### 3.4.1 GitHub Actions ワークフロー

```yaml
name: Update LoL Dashboard

on:
  workflow_dispatch:  # 手動トリガー

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: pip install -r requirements.txt
        
      - name: Fetch match data
        env:
          RIOT_API_KEY: ${{ secrets.RIOT_API_KEY }}
          SUMMONER_NAME: ${{ secrets.SUMMONER_NAME }}
        run: python src/fetch_matches.py
        
      - name: Generate HTML
        run: python src/generate_html.py
        
      - name: Commit data
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/ docs/
          git commit -m "Update match data" || echo "No changes"
          git push
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
```

#### 3.4.2 GitHub Secrets 設定

ユーザーが手動で設定する必要がある項目：

- `RIOT_API_KEY`: Riot Developer Portal で取得したPersonal API Key
- `SUMMONER_NAME`: 自分のサマナー名

#### 3.4.3 公開URL

```
https://{username}.github.io/{repo-name}/
```

例: `https://mikeneko.github.io/lol-dashboard/`

---

## 4. 非機能要件

### 4.1 パフォーマンス要件

|項目|目標値|測定方法|
|---|---|---|
|HTML表示速度|2秒以内|ブラウザDevTools|
|初回データ取得時間|90分以内|GitHub Actions実行ログ|
|2回目以降更新時間|2分以内（週50試合想定）|GitHub Actions実行ログ|
|フィルター切り替え|0.5秒以内|クライアント側JS処理|

### 4.2 セキュリティ要件

|項目|対策|
|---|---|
|API Key管理|GitHub Secrets に保存。コードには一切埋め込まない|
|リポジトリ公開|Public推奨（コードのみ公開、API Keyは非公開）|
|個人情報|Summoner Nameと試合履歴は公開情報（既存サイトと同等）|
|CORS対策|静的HTML + JS なので問題なし|

### 4.3 コスト要件

- **絶対条件**: 全コスト $0
- GitHub Free プラン利用
- Riot API Personal Key（無料）
- GitHub Pages（無料）
- GitHub Actions（月2,000分無料枠内）

### 4.4 保守性要件

- **コード規約**: PEP 8準拠
- **コメント**: 主要関数に docstring
- **設定外部化**: `config.json` で変更可能に
    
    ```json
    {  "summoner_name": "YourName",  "region": "jp1",  "display_matches": 20,  "language": "ja_JP"}
    ```
    
- **エラーログ**: GitHub Actions のログに出力
- **依存ライブラリ**: `requirements.txt` で管理

### 4.5 拡張性要件

- 新ゲームモード追加時も自動対応（queueIdの動的判定）
- 友人への配布を想定した設計
    - フォーク → `config.json` 書き換え → Secrets設定 で利用可能
    - README に導入手順を記載

---

## 5. 技術選定と根拠

### 5.1 なぜ静的HTMLか

|代替案|不採用理由|
|---|---|
|React/Vue SPA|ビルド環境不要、学習コスト削減|
|バックエンドAPI|サーバー費用発生、複雑化|
|データベース|無料枠制限、Git で十分|

**結論**: 静的HTML + Vanilla JS が最もシンプルでコスト0を実現できる

### 5.2 なぜGitにデータを保存するか

|代替案|不採用理由|
|---|---|
|毎回API全取得|時間かかる、API無駄遣い|
|外部DB（Firebase等）|無料枠制限、複雑化|
|ローカルストレージ|共有不可、バックアップ困難|

**結論**: Gitリポジトリが履歴管理・差分更新・バックアップを兼ねる

### 5.3 使用ライブラリ

```
# requirements.txt
requests==2.31.0        # HTTP通信
jinja2==3.1.2          # HTMLテンプレート
python-dateutil==2.8.2  # 日時処理
```

最小限の依存で保守性を確保

---

## 6. リスク一覧と対策

### 6.1 技術的リスク

|リスク|影響度|発生確率|対策|
|---|---|---|---|
|Riot API レート制限超過|高|中|sleep() で制限、リトライロジック実装|
|API仕様変更|中|低|公式ドキュメント監視、エラーハンドリング|
|初回取得タイムアウト|中|中|GitHub Actions タイムアウト6時間→十分|
|Data Dragon 画像404|低|低|プレースホルダー画像表示|
|JSONファイル肥大化|低|低|5000試合でも20MB程度、Git LFS不要|

### 6.2 運用リスク

|リスク|影響度|発生確率|対策|
|---|---|---|---|
|API Key 期限切れ|高|低|Personal Keyは基本無期限、エラー時に通知|
|GitHub Pages 停止|中|極低|バックアッププランなし（発生時再検討）|
|新パッチでアイテムID変更|低|低|Data Dragon が自動対応|

### 6.3 開発リスク

|リスク|影響度|発生確率|対策|
|---|---|---|---|
|実装が1週間で終わらない|高|中|優先順位明確化（後述Phase分け）|
|Riot API連携不具合|中|中|早期にAPI接続テスト実施|
|UI実装の時間超過|中|中|デザインはシンプル優先、装飾は後回し|

---

## 7. 開発フェーズ提案

### Phase 1: 基盤構築（1-2日目）

**目標**: API接続とデータ取得の確立

- [ ] GitHub リポジトリ作成
- [ ] Riot API Personal Key 取得
- [ ] Python環境セットアップ
- [ ] API接続テスト（Summoner情報取得）
- [ ] 試合IDリスト取得（直近10試合程度）
- [ ] 試合詳細取得（1試合）
- [ ] JSON保存ロジック実装

**成果物**: `data/matches.json` に試合データ保存成功

### Phase 2: データ取得完成（3日目）

**目標**: 全履歴取得と差分更新

- [ ] 全試合履歴取得ロジック（ページネーション）
- [ ] レート制限対策（sleep + リトライ）
- [ ] 差分更新ロジック（last_update以降のみ取得）
- [ ] エラーハンドリング（API障害時）
- [ ] GitHub Actions ワークフロー作成

**成果物**: 初回実行で全履歴取得成功、2回目以降は差分更新

### Phase 3: 統計計算（4日目）

**目標**: データ集計とフィルター実装

- [ ] チャンピオン別統計計算
- [ ] 期間別フィルター実装（全期間/パッチ/週）
- [ ] モード別フィルター実装
- [ ] KDA、勝率、平均値計算
- [ ] 試合履歴リスト生成

**成果物**: Python側で統計データ生成完了

### Phase 4: HTML生成（5日目）

**目標**: 静的HTML出力

- [ ] Jinja2 テンプレート作成
    - `templates/index.html`（メイン）
    - `templates/match_detail_modal.html`（モーダル）
- [ ] CSS作成（DeepLoL風デザイン）
- [ ] 統計テーブル描画
- [ ] 試合履歴カード描画
- [ ] Data Dragon 画像URL生成

**成果物**: 静的HTML出力成功、ローカルで表示確認

### Phase 5: フロントエンド機能（6日目）

**目標**: フィルター・ソート・モーダル実装

- [ ] フィルター切り替えJS実装
- [ ] テーブルソートJS実装
- [ ] 試合詳細モーダル実装
- [ ] アイテムビルドタイムライン表示
- [ ] ルーン表示
- [ ] 画像読み込みエラー処理

**成果物**: フルインタラクティブなダッシュボード完成

### Phase 6: デプロイとテスト（7日目）

**目標**: GitHub Pages 公開とバグ修正

- [ ] GitHub Pages 設定
- [ ] Actions からデプロイ確認
- [ ] 実データでの動作確認
- [ ] UI調整
- [ ] README 作成（使い方、友人への配布手順）
- [ ] バグ修正

**成果物**: 公開URLでアクセス可能、LT発表準備完了

---

## 8. 導入手順（友人への配布想定）

### 8.1 前提条件

- GitHubアカウント
- Riot Developer Portal アカウント

### 8.2 セットアップ手順

1. このリポジトリをフォーク
2. `config.json` を編集
    
    ```json
    {  "summoner_name": "自分のサマナー名",  "region": "jp1"}
    ```
    
3. GitHub Settings → Secrets に以下を追加
    - `RIOT_API_KEY`: [Riot Developer Portal](https://developer.riotgames.com/) で取得
    - `SUMMONER_NAME`: 自分のサマナー名
4. Settings → Pages → Source を "gh-pages branch" に設定
5. Actions タブ → "Update LoL Dashboard" → "Run workflow"
6. 初回は30-90分待つ
7. `https://{username}.github.io/lol-dashboard/` にアクセス

---

## 9. ファイル構成

```
lol-dashboard/
├── .github/
│   └── workflows/
│       └── update.yml          # GitHub Actions定義
├── data/
│   └── matches.json            # 試合データ（Git管理）
├── docs/                       # GitHub Pages公開ディレクトリ
│   ├── index.html              # 生成されたダッシュボード
│   ├── css/
│   │   └── style.css
│   └── js/
│       └── dashboard.js        # フィルター・ソート処理
├── src/
│   ├── fetch_matches.py        # Riot API からデータ取得
│   ├── calculate_stats.py      # 統計計算
│   └── generate_html.py        # HTML生成（Jinja2）
├── templates/
│   ├── index.html              # メインテンプレート
│   └── match_detail_modal.html # モーダルテンプレート
├── config.json                 # 設定ファイル
├── requirements.txt            # Python依存
└── README.md                   # 導入手順
```

---

## 10. 成功基準

### 10.1 機能的成功基準

- [ ] 全試合履歴を取得できる
- [ ] チャンピオン別統計が正しく表示される
- [ ] 期間・モードフィルターが動作する
- [ ] 試合詳細で10人のビルド・ルーンが見える
- [ ] GitHub Pages で公開できる

### 10.2 非機能的成功基準

- [ ] コスト $0 を維持
- [ ] HTML表示が2秒以内
- [ ] 2回目以降の更新が2分以内
- [ ] API Key が漏洩しない

### 10.3 LT発表基準

- [ ] デモ画面を見せられる
- [ ] 「Claude → Cursor」ワークフローを説明できる
- [ ] 質疑応答に耐えうる完成度

---

## 11. 補足事項

### 11.1 Riot API 制限詳細

- Personal Key: 20リクエスト/秒、100リクエスト/2分
- 商用利用不可（個人・友人間の共有はOK）
- 取得可能な試合履歴は過去2年程度（Riot側の保持期間）

### 11.2 Data Dragon バージョン管理

- 最新パッチ番号を `https://ddragon.leagueoflegends.com/api/versions.json` から取得
- HTML生成時に埋め込み、画像URLに使用
- パッチ更新時も自動対応（再実行で最新版取得）

### 11.3 ゲームモード対応

既知のqueueId:

- 420: ソロ/デュオ
- 440: フレックス
- 400/430: ノーマル
- 450: ARAM
- 1700: Arena（期間限定）
- 1900: URF（期間限定）

未知のqueueIdは「その他」として表示し、モード名はRiot APIから取得して表示

### 11.4 今後の拡張可能性（スコープ外）

- 勝率グラフ（Chart.js導入）
- チャンピオンごとのアイテムビルド分析
- 味方・敵チームの統計比較
- 自動更新（cron設定）
- Discord通知連携

---

